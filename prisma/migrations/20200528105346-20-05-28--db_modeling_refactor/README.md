# Migration `20200528105346-20-05-28--db_modeling_refactor`

This migration has been generated by dnatuna at 5/28/2020, 10:53:46 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
DROP TABLE `habit_bread`.`commit_history`;

DROP TABLE `habit_bread`.`habits`;

DROP TABLE `habit_bread`.`items`;

DROP TABLE `habit_bread`.`ranking`;

DROP TABLE `habit_bread`.`scheduler`;

DROP TABLE `habit_bread`.`users`;

DROP TABLE `habit_bread`.`user_item`;

CREATE TABLE `habit_bread`.`ranking` (
`exp` int NOT NULL  ,`persent` int NOT NULL  ,`ranking_id` int NOT NULL  ,`user_id` int NOT NULL  ,`user_name` varchar(191) NOT NULL  ,
    PRIMARY KEY (`ranking_id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `habit_bread`.`scheduler` (
`habit_alarm_at` datetime(3) NOT NULL  ,`habit_id` varchar(191) NOT NULL  ,`habit_title` varchar(191) NOT NULL  ,`habit_type` int NOT NULL  ,`schedule_id` int NOT NULL  ,`user_id` int NOT NULL  ,
    PRIMARY KEY (`schedule_id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `habit_bread`.`habits` (
`category` varchar(191) NOT NULL  ,`description` varchar(191)   ,`habit_id` int NOT NULL  AUTO_INCREMENT,`title` varchar(191) NOT NULL  ,`user_id` int NOT NULL ,
    PRIMARY KEY (`habit_id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `habit_bread`.`commit_history` (
`created_at` datetime(3) NOT NULL  ,`habit_id` int NOT NULL ,
    PRIMARY KEY (`created_at`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `habit_bread`.`users` (
`created_at` datetime  DEFAULT CURRENT_TIMESTAMP ,`email` varchar(191) NOT NULL  ,`exp` int NOT NULL DEFAULT 0 ,`image_url` varchar(191)   ,`name` varchar(191) NOT NULL  ,`oauth_key` varchar(191) NOT NULL  ,`updated_at` datetime(3)   ,`user_id` int NOT NULL  AUTO_INCREMENT,
    PRIMARY KEY (`user_id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `habit_bread`.`user_item` (
`createdAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ,`item_id` int NOT NULL ,`user_id` int NOT NULL ,
    PRIMARY KEY (`item_id`,`user_id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `habit_bread`.`items` (
`description` varchar(191) NOT NULL  ,`item_id` int NOT NULL  AUTO_INCREMENT,`level` int NOT NULL  ,`name` varchar(191) NOT NULL  ,`userUserId` int  ,
    PRIMARY KEY (`item_id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE  INDEX `fk_Habit_User1_idx` ON `habit_bread`.`habits`(`user_id`)

CREATE  INDEX `fk_Habit_History_Habit1_idx` ON `habit_bread`.`commit_history`(`habit_id`)

CREATE UNIQUE INDEX `users.email` ON `habit_bread`.`users`(`email`)

CREATE UNIQUE INDEX `users.oauth_key` ON `habit_bread`.`users`(`oauth_key`)

ALTER TABLE `habit_bread`.`habits` ADD FOREIGN KEY (`user_id`) REFERENCES `habit_bread`.`users`(`user_id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `habit_bread`.`commit_history` ADD FOREIGN KEY (`habit_id`) REFERENCES `habit_bread`.`habits`(`habit_id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `habit_bread`.`user_item` ADD FOREIGN KEY (`item_id`) REFERENCES `habit_bread`.`items`(`item_id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `habit_bread`.`user_item` ADD FOREIGN KEY (`user_id`) REFERENCES `habit_bread`.`users`(`user_id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `habit_bread`.`items` ADD FOREIGN KEY (`userUserId`) REFERENCES `habit_bread`.`users`(`user_id`) ON DELETE SET NULL ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200528105346-20-05-28--db_modeling_refactor
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,90 @@
+generator client {
+  provider = "prisma-client-js"
+}
+
+datasource mysql {
+  provider = "mysql"
+  url      = env("DB_URL")
+}
+
+model Ranking {
+  rankingId     Int       @id      @map("ranking_id")
+  userId        Int    @map("user_id")
+  userName      String    @map("user_name")
+  exp           Int
+  persent       Int
+
+  @@map("ranking")
+}
+
+model Scheduler {
+  scheduleId    Int       @id @map("schedule_id")
+  userId        Int    @map("user_id")
+  habitId       String    @map("habit_id")
+  habitTitle    String    @map("habit_title")
+  habitAlarmAt  DateTime  @map("habit_alarm_at")
+  habitType     Int       @map("habit_type")
+
+  @@map("scheduler")
+}
+
+model Habit {
+  habitId       Int       @default(autoincrement()) @id @map("habit_id")
+  userId        Int    @map("user_id")
+  title         String
+  description   String?
+  category      String
+
+  commitHistory CommitHistory[]
+  user          User      @relation(fields: [userId], references: [userId])
+
+  @@index([userId], name: "fk_Habit_User1_idx")
+  @@map("habits")
+}
+
+model CommitHistory {
+  createdAt     DateTime  @default(now()) @map("created_at") @id
+  habitId       Int       @map("habit_id")
+
+  habits        Habit     @relation(fields: [habitId], references: [habitId])
+
+  @@index([habitId], name: "fk_Habit_History_Habit1_idx")
+  @@map("commit_history")
+}
+
+
+model User {
+  userId        Int    @default(autoincrement()) @id @map("user_id")
+  name          String
+  email         String    @unique
+  exp           Int       @default(0)
+  imageUrl      String?   @map("image_url")
+  createdAt     DateTime? @map("created_at") @default(now())
+  updatedAt     DateTime? @map("updated_at") @updatedAt
+  oauthKey      String    @map("oauth_key") @unique
+
+  items         Item[]
+  habits        Habit[]
+
+  @@map("users")
+}
+
+model UserItem {
+  itemId      Int       @map("item_id")
+  userId      Int    @map("user_id")
+  item        Item      @relation(fields: [itemId], references: [itemId])
+  user        User      @relation(fields: [userId], references: [userId])
+  createdAt   DateTime  @default(now())
+
+  @@id([itemId, userId])
+  @@map("user_item")
+}
+
+model Item {
+  itemId        Int       @default(autoincrement()) @id @map("item_id")
+  name          String
+  description   String
+  level         Int
+  
+  @@map("items")
+}
```


