# Migration `20200502183854-20-05-07--chang_habit_user_relation-db`

This migration has been generated by dnatuna at 5/2/2020, 6:38:54 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE `habit_bread`.`habits` DROP COLUMN `is_scheduled`,
ADD COLUMN `user_id` int NOT NULL ;

ALTER TABLE `habit_bread`.`user_habit` DROP FOREIGN KEY `user_habit_ibfk_1`;

ALTER TABLE `habit_bread`.`user_habit` DROP FOREIGN KEY `user_habit_ibfk_2`;

ALTER TABLE `habit_bread`.`habits` ADD FOREIGN KEY (`user_id`) REFERENCES `habit_bread`.`users`(`user_id`) ON DELETE CASCADE ON UPDATE CASCADE

DROP TABLE `habit_bread`.`user_habit`;
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200502172005-20-05-02--fix_field_name_convention..20200502183854-20-05-07--chang_habit_user_relation-db
--- datamodel.dml
+++ datamodel.dml
@@ -3,9 +3,9 @@
 }
 datasource mysql {
   provider = "mysql"
-  url = "***"
+  url      = env("DB_URL")
 }
 model Character {
   characterId   Int   @id
@@ -17,32 +17,20 @@
   @@map("characters")
 }
 model CommitHistory {
-  createdAt DateTime @default(now()) @map("created_at")
-  habitId   Int      @map("habit_id")
-  historyId Int      @default(autoincrement()) @id @map("history_id")
-  userId    Int     @map("user_id")
-  habits     Habit   @relation(fields: [habitId], references: [habitId])
-  users      User    @relation(fields: [userId], references: [userId])
+  createdAt   DateTime  @default(now()) @map("created_at")
+  habitId     Int       @map("habit_id")
+  historyId   Int       @default(autoincrement()) @id @map("history_id")
+  userId      Int       @map("user_id")
+  habits      Habit     @relation(fields: [habitId], references: [habitId])
+  users       User      @relation(fields: [userId], references: [userId])
   @@index([habitId], name: "fk_Habit_History_Habit1_idx")
   @@index([userId], name: "fk_Habit_History_User1_idx")
   @@map("commit_history")
 }
-model Habit {
-  category        String
-  description     String?
-  habitId         Int         @default(autoincrement()) @id @map("habit_id")
-  isScheduled     Int         @map("is_scheduled")
-  title           String
-  commitHistory   CommitHistory[]
-  userHabit       UserHabit[]
-
-  @@map("habits")
-}
-
 model Ranking {
   exp         Int
   rankingId   Int             @id      @map("ranking_id")
   userName    String          @map("user_name")
@@ -60,8 +48,19 @@
   @@map("scheduler")
 }
+model Habit {
+  category        String
+  description     String?
+  habitId         Int         @default(autoincrement()) @id @map("habit_id")
+  title           String
+  user            User        @relation(fields: [userId], references: [userId])
+  userId          Int         @map("user_id")
+
+  @@map("habits")
+}
+
 model User {
   appleId       String?     @map("apple_id")
   createdAt     DateTime?   @map("created_at")
   email         String
@@ -71,20 +70,8 @@
   updatedAt     DateTime?   @map("updated_at")
   userId        Int         @default(autoincrement()) @id @map("user_id")
   characters    Character[]
   commitHistory CommitHistory[]
-  userHabit     UserHabit[]
+  Habit         Habit[]
   @@map("users")
-}
-
-model UserHabit {
-  habitId   Int   @map("habit_id")
-  userId    Int   @map("user_id")
-  habits    Habit @relation(fields: [habitId], references: [habitId])
-  users     User  @relation(fields: [userId], references: [userId])
-
-  @@id([userId, habitId])
-  @@index([habitId], name: "fk_User_Habit_Habit1_idx")
-  @@index([userId], name: "fk_User_Habit_User1_idx")
-  @@map("user_habit")
 }
```


